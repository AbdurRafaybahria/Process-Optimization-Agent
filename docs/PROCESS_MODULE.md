# Process Module

## Overview

The Process module manages business processes and their lifecycle: creation, retrieval, updates, versioning, and relationships to tasks, categories, and companies. It provides APIs and data models used by frontend and other services to orchestrate workflows.

## Responsibilities

- CRUD for processes
- Process versioning and cloning
- Associating tasks and task-ordering
- Scoping processes to companies (multi-tenant behaviour)
- Validation, basic authorization checks, and soft-deletes

## Key Entities

- Process: top-level workflow entity (id, name, description, version, status, companyId)
- ProcessCategory: classification for processes
- Task: ordered work item associated with a Process
- ProcessVersion: historical/versioned copies for safe edits

## Primary API Endpoints

- `GET /processes` — list processes (supports `companyId`, `page`, `limit`, `search`, `include=relations`)
- `GET /processes/:id` — retrieve single process (optionally include tasks and versions)
- `POST /processes` — create a new process (`CreateProcessDto`)
- `PATCH /processes/:id` — update process metadata (`UpdateProcessDto`)
- `DELETE /processes/:id` — soft-delete a process
- `POST /processes/:id/clone` — clone existing process into a new version/copy
- `GET /processes/:id/tasks` — list tasks for a process

Notes:
- Use query parameters to filter by company and to request related resources in a single call.
- API responses follow the project-wide pagination and error conventions.

## DTOs / Shape

- `CreateProcessDto` — `name`, `description?`, `categoryId?`, `companyId`, `tasks?` (optional inline task definitions)
- `UpdateProcessDto` — any mutable process fields; avoid changing immutable fields like `id` and historical `version` directly

## Database / Prisma

See the project schema for canonical models: [server/prisma/schema.prisma](server/prisma/schema.prisma)

Typical fields stored: `id`, `name`, `description`, `version`, `status`, `companyId`, `createdAt`, `updatedAt`, `deletedAt`

## Relationships

- A `Process` has many `Task` entities (ordered)
- `Process` belongs to a `Company` (company-scoped uniqueness rules apply)
- `Process` may have a `Category`

## Example: Create payload

```json
{
  "name": "Monthly Safety Inspection",
  "description": "Steps for monthly building safety checks",
  "companyId": "company_abc",
  "tasks": [
    { "name": "Check fire extinguishers", "order": 1 },
    { "name": "Verify emergency exits", "order": 2 }
  ]
}
```

## Notes for Developers

- When updating processes that include tasks, prefer using endpoints that accept complete task lists or specific task mutation endpoints to avoid ordering conflicts.
- Trigger process version creation when editing published processes to preserve running instances.
- Add integration tests under `server/test` covering create/update/clone flows.

## Where to look in code

- Controller: `server/src/process` (controllers)
- Service & business logic: `server/src/process` (services)
- DTOs: `server/src/process/dto`

---

If you want this file to follow a different naming scheme or include autogenerated endpoint examples from the code, tell me and I can extend it.
